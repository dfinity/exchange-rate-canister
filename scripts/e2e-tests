#!/usr/bin/env bash

# vim: ft=bash

# Builds the wasm locally, the e2e base image, moves the wasm to the
# appropriate location, and runs the tests

# Build the wasm without needing a canister
dfx build --check xrc
# Build the e2e base image
docker-compose -f src/xrc-tests/docker/docker-compose.yml build base
# Copy the built wasm to the target directory
mkdir -p src/xrc-tests/gen/canister
cp target/wasm32-unknown-unknown/release/xrc.wasm src/xrc-tests/gen/canister
# Run the system tests
cargo run --bin xrc-tests --release -- basic
cargo run --bin xrc-tests --release -- cache